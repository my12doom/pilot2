#include <stdio.h>
#include <math.h>
#include <string.h>
#include <stdlib.h>
#include <HAL/Interface/Interfaces.h>
#include <HAL/STM32F4/F4GPIO.h>
#include <HAL/Resources.h>
#include <utils/param.h>
#include <FileSystem/ff.h>
#include <utils/log.h>
#include <stm32f4xx_gpio.h>
#include <stm32f4xx_tim.h>
#include <stm32f4xx_rcc.h>
#include <stm32f4xx_dma.h>
#include <stm32f4xx_adc.h>
#include <stm32f4xx_dac.h>
#include <HAL/sensors/MPU6000.h>
#include <Protocol/common.h>

using namespace HAL;
using namespace devices;
using namespace sensors;
using namespace STM32F4;

struct __FILE { int handle; /* Add whatever you need here */ };
#define ITM_Port8(n)    (*((volatile unsigned char *)(0xE0000000+4*n)))
#define ITM_Port16(n)   (*((volatile unsigned short*)(0xE0000000+4*n)))
#define ITM_Port32(n)   (*((volatile unsigned long *)(0xE0000000+4*n)))
#define DEMCR           (*((volatile unsigned long *)(0xE000EDFC)))
#define TRCENA          0x01000000



extern "C" int fputc(int ch, FILE *f)
{
	if (DEMCR & TRCENA) 
	{
		while (ITM_Port32(0) == 0);
		ITM_Port8(0) = ch;
	}
	return (ch);
}

int init_tim1()
{
	// GPIO:
	// open A8~10 as output (TIM1 channel 1~3)
	GPIO_InitTypeDef GPIO_InitStructure = {0};	
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_TIM1, ENABLE);	
	GPIO_InitStructure.GPIO_Pin =  GPIO_Pin_7 | GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;	
	GPIO_Init(GPIOA, &GPIO_InitStructure);

	GPIO_InitStructure.GPIO_Pin =  GPIO_Pin_0 | GPIO_Pin_1;
	GPIO_Init(GPIOB, &GPIO_InitStructure);
	
	GPIO_PinAFConfig(GPIOA, GPIO_PinSource8, GPIO_AF_TIM1);
	GPIO_PinAFConfig(GPIOA, GPIO_PinSource9, GPIO_AF_TIM1);
	GPIO_PinAFConfig(GPIOA, GPIO_PinSource10, GPIO_AF_TIM1);
	GPIO_PinAFConfig(GPIOA, GPIO_PinSource7, GPIO_AF_TIM1);
	GPIO_PinAFConfig(GPIOB, GPIO_PinSource0, GPIO_AF_TIM1);
	GPIO_PinAFConfig(GPIOB, GPIO_PinSource1, GPIO_AF_TIM1);
	
	// Time base configuration
	TIM_TimeBaseInitTypeDef  TIM_TimeBaseStructure;
	TIM_TimeBaseStructure.TIM_Prescaler = 0;
	TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_CenterAligned1;
	TIM_TimeBaseStructure.TIM_Period = 4096;
	TIM_TimeBaseStructure.TIM_ClockDivision = TIM_CKD_DIV1;
	TIM_TimeBaseInit(TIM1, &TIM_TimeBaseStructure);
	
	
	// OC ( Output Control)
	TIM_OCInitTypeDef  TIM_OCInitStructure;	
	TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;
	TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;
	TIM_OCInitStructure.TIM_OutputNState = TIM_OutputNState_Enable;
	TIM_OCInitStructure.TIM_Pulse = 0;
	TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;
	TIM_OCInitStructure.TIM_OCNPolarity = TIM_OCNPolarity_High;
	TIM_OCInitStructure.TIM_OCIdleState = TIM_OCIdleState_Set;
	TIM_OCInitStructure.TIM_OCNIdleState = TIM_OCIdleState_Reset;
	TIM_OC1Init(TIM1, &TIM_OCInitStructure);
	TIM_OC2Init(TIM1, &TIM_OCInitStructure);
	TIM_OC3Init(TIM1, &TIM_OCInitStructure);
	TIM_OC4Init(TIM1, &TIM_OCInitStructure);
	
	// ËÀÇø
	/*
	TIM_BDTRInitTypeDef TIM_BDTRInitStructure;
	TIM_BDTRInitStructure.TIM_OSSRState = TIM_OSSRState_Enable;
	TIM_BDTRInitStructure.TIM_OSSIState = TIM_OSSIState_Enable;
	TIM_BDTRInitStructure.TIM_LOCKLevel = TIM_LOCKLevel_OFF;
	TIM_BDTRInitStructure.TIM_DeadTime = 0;  //ËÀÇø0-0xff
	TIM_BDTRInitStructure.TIM_Break = TIM_Break_Enable;
	TIM_BDTRInitStructure.TIM_BreakPolarity = TIM_BreakPolarity_Low;
	TIM_BDTRInitStructure.TIM_AutomaticOutput = TIM_AutomaticOutput_Enable;
	TIM_BDTRConfig(TIM1, &TIM_BDTRInitStructure);
	*/
	TIM1->BDTR |= 1<<15 | 75;


	TIM_ARRPreloadConfig(TIM1, ENABLE);

	TIM_OC1PreloadConfig(TIM1, TIM_OCPreload_Enable);
	TIM_OC2PreloadConfig(TIM1, TIM_OCPreload_Enable);
	TIM_OC3PreloadConfig(TIM1, TIM_OCPreload_Enable);
	TIM_OC4PreloadConfig(TIM1, TIM_OCPreload_Enable);


	TIM_Cmd(TIM1, ENABLE);

	
	TIM1->CCR1 = 0;
	TIM1->CCR2 = 0;
	TIM1->CCR3 = 0;
	
	return 0;
}

uint16_t adc[6];

int init_adc()
{
	// power
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE);
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_DMA2, ENABLE);
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_SYSCFG, ENABLE);
	
	
	// GPIO
	GPIO_InitTypeDef GPIO_InitStructure;
	
	/* Configure PA.06  as analog input */
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_1 | GPIO_Pin_2 | GPIO_Pin_3;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AIN;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL ;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_Init(GPIOA, &GPIO_InitStructure);
	
	
	
	// ADC1 configuration	
	ADC_CommonInitTypeDef ADC_CommonInitStructure;
	ADC_CommonInitStructure.ADC_Mode = ADC_Mode_Independent;
	ADC_CommonInitStructure.ADC_Prescaler = ADC_Prescaler_Div2;
	ADC_CommonInitStructure.ADC_DMAAccessMode = ADC_DMAAccessMode_Disabled;
	ADC_CommonInitStructure.ADC_TwoSamplingDelay = ADC_TwoSamplingDelay_5Cycles;
	ADC_CommonInit(&ADC_CommonInitStructure);

	ADC_InitTypeDef ADC_InitStructure;
	ADC_InitStructure.ADC_Resolution = ADC_Resolution_12b;
	ADC_InitStructure.ADC_ScanConvMode = DISABLE;
	ADC_InitStructure.ADC_ContinuousConvMode = DISABLE;
	ADC_InitStructure.ADC_ExternalTrigConvEdge = ADC_ExternalTrigConvEdge_Rising;
	ADC_InitStructure.ADC_ExternalTrigConv = ADC_ExternalTrigConv_T1_CC1;
	ADC_InitStructure.ADC_DataAlign = ADC_DataAlign_Right;
	ADC_InitStructure.ADC_NbrOfConversion = 1;

	ADC_Init(ADC1, &ADC_InitStructure);
	ADC_EOCOnEachRegularChannelCmd(ADC1,DISABLE);
	
	ADC_RegularChannelConfig(ADC1, ADC_Channel_1, 1, ADC_SampleTime_3Cycles);
	ADC_DMARequestAfterLastTransferCmd(ADC1, ENABLE);
	
	/* Enable ADC1 DMA */
	ADC_DMACmd(ADC1, ENABLE);
	
	/* Enable ADC1 */
	ADC_Cmd(ADC1, ENABLE);
	
	
	
	
	
		// DMA channel1 configuration 
	NVIC_InitTypeDef   NVIC_InitStructure;

	// Enable the DMA2_Stream0 global Interrupt
	NVIC_InitStructure.NVIC_IRQChannel = DMA2_Stream0_IRQn;
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0x06;
	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 1;
	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
	NVIC_Init(&NVIC_InitStructure);
	
	// DMA2 Stream0 channel0 configuration
	DMA_InitTypeDef DMA_InitStructure;
	DMA_InitStructure.DMA_Channel = DMA_Channel_0;
	DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)&(ADC1->DR);
	DMA_InitStructure.DMA_Memory0BaseAddr = (uint32_t)&adc[0];
	DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralToMemory;
	DMA_InitStructure.DMA_BufferSize = 1;
	DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
	DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Disable;
	DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_HalfWord;
	DMA_InitStructure.DMA_MemoryDataSize = DMA_PeripheralDataSize_HalfWord;
	DMA_InitStructure.DMA_Mode = DMA_Mode_Circular;
	DMA_InitStructure.DMA_Priority = DMA_Priority_High;
	DMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Disable;         
	DMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_HalfFull;
	DMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_Single;
	DMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;
	DMA_DeInit(DMA2_Stream0);
	DMA_Init(DMA2_Stream0, &DMA_InitStructure);
	DMA_Cmd(DMA2_Stream0, ENABLE);
	DMA_ClearFlag(DMA2_Stream0,DMA_FLAG_TCIF0);
	//DMA_ITConfig(DMA2_Stream0,DMA_IT_TC,ENABLE);
}

int init_adc2()
{
	// power
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC2, ENABLE);
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_DMA2, ENABLE);
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_SYSCFG, ENABLE);
	
	
	// GPIO
	GPIO_InitTypeDef GPIO_InitStructure;
	
	/* Configure PA.06  as analog input */
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_1 | GPIO_Pin_2 | GPIO_Pin_3;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AIN;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL ;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_Init(GPIOA, &GPIO_InitStructure);
	
	
	
	// ADC1 configuration	
	ADC_CommonInitTypeDef ADC_CommonInitStructure;
	ADC_CommonInitStructure.ADC_Mode = ADC_Mode_Independent;
	ADC_CommonInitStructure.ADC_Prescaler = ADC_Prescaler_Div2;
	ADC_CommonInitStructure.ADC_DMAAccessMode = ADC_DMAAccessMode_Disabled;
	ADC_CommonInitStructure.ADC_TwoSamplingDelay = ADC_TwoSamplingDelay_5Cycles;
	ADC_CommonInit(&ADC_CommonInitStructure);

	ADC_InitTypeDef ADC_InitStructure;
	ADC_InitStructure.ADC_Resolution = ADC_Resolution_12b;
	ADC_InitStructure.ADC_ScanConvMode = DISABLE;
	ADC_InitStructure.ADC_ContinuousConvMode = DISABLE;
	ADC_InitStructure.ADC_ExternalTrigConvEdge = ADC_ExternalTrigConvEdge_Rising;
	ADC_InitStructure.ADC_ExternalTrigConv = ADC_ExternalTrigConv_T1_CC2;
	ADC_InitStructure.ADC_DataAlign = ADC_DataAlign_Right;
	ADC_InitStructure.ADC_NbrOfConversion = 1;

	ADC_Init(ADC2, &ADC_InitStructure);
	ADC_EOCOnEachRegularChannelCmd(ADC2,DISABLE);
	
	ADC_RegularChannelConfig(ADC2, ADC_Channel_2, 1, ADC_SampleTime_3Cycles);
	ADC_DMARequestAfterLastTransferCmd(ADC2, ENABLE);
	
	/* Enable ADC1 DMA */
	ADC_DMACmd(ADC2, ENABLE);
	
	/* Enable ADC1 */
	ADC_Cmd(ADC2, ENABLE);
	
	
	
	
	
		// DMA channel1 configuration 
	NVIC_InitTypeDef   NVIC_InitStructure;

	// Enable the DMA2_Stream0 global Interrupt
	NVIC_InitStructure.NVIC_IRQChannel = DMA2_Stream2_IRQn;
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0x06;
	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 1;
	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
	NVIC_Init(&NVIC_InitStructure);
	
	// DMA2 Stream0 channel0 configuration
	DMA_InitTypeDef DMA_InitStructure;
	DMA_InitStructure.DMA_Channel = DMA_Channel_1;
	DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)&(ADC2->DR);
	DMA_InitStructure.DMA_Memory0BaseAddr = (uint32_t)&adc[1];
	DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralToMemory;
	DMA_InitStructure.DMA_BufferSize = 1;
	DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
	DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Disable;
	DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_HalfWord;
	DMA_InitStructure.DMA_MemoryDataSize = DMA_PeripheralDataSize_HalfWord;
	DMA_InitStructure.DMA_Mode = DMA_Mode_Circular;
	DMA_InitStructure.DMA_Priority = DMA_Priority_High;
	DMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Disable;         
	DMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_HalfFull;
	DMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_Single;
	DMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;
	DMA_DeInit(DMA2_Stream2);
	DMA_Init(DMA2_Stream2, &DMA_InitStructure);
	DMA_Cmd(DMA2_Stream2, ENABLE);
	DMA_ClearFlag(DMA2_Stream2,DMA_FLAG_TCIF0);
	//DMA_ITConfig(DMA2_Stream0,DMA_IT_TC,ENABLE);
}

void DMA2_Stream0_IRQHandler(void)
{
	//ADC1_Convert_End();
	DMA_ClearITPendingBit(DMA2_Stream0,DMA_IT_TCIF0);	
}


void CalcTimes_C(float &T1, float &T2, uint16_t &Ta, uint16_t &Tb, uint16_t &Tc)
{
	T1 *= TIM1->ARR;
	T2 *= TIM1->ARR;
	Ta = (TIM1->ARR-T1-T2)/2;
	Tb = Ta + T1;
	Tc = Tb + T2;
}

#define CalcTimes(x) CalcTimes_C(T1, T2, Ta, Tb, Tc)

float T1, T2;
int sector = 0;
uint16_t Ta, Tb, Tc;
int apply_power(float Vr1, float Vr2, float Vr3)
{
	uint16_t period = TIM1->ARR;
	uint16_t dPWM1 = 0, dPWM2 = 0, dPWM3 = 0;
	
	if( Vr1 >= 0 )
	{
		// (xx1)
		if( Vr2 >= 0 )
		{
			// (x11)
			// Must be Sector 3 since Sector 7 not allowed
			// Sector 3: (0,1,1)  0-60 degrees
			T1 = Vr2;
			T2 = Vr1;
			CalcTimes();
			dPWM1 = Ta;
			dPWM2 = Tb;
			dPWM3 = Tc;
			sector = 0;
		}
		else
		{
			// (x01)
			if( Vr3 >= 0 )
			{
				// Sector 5: (1,0,1)  120-180 degrees
				T1 = Vr1;
				T2 = Vr3;
				CalcTimes();
				dPWM1 = Tc;
				dPWM2 = Ta;
				dPWM3 = Tb;
				sector = 1;
			}
			else
			{
				// Sector 1: (0,0,1)  60-120 degrees
				T1 = -Vr2;
				T2 = -Vr3;
				CalcTimes();
				dPWM1 = Tb;
				dPWM2 = Ta;
				dPWM3 = Tc;
				sector = 2;
			}
		}
	}
	else
	{
		// (xx0)
		if( Vr2 >= 0 )
		{
			// (x10)
			if( Vr3 >= 0 )
			{
				// Sector 6: (1,1,0)  240-300 degrees
				T1 = Vr3;
				T2 = Vr2;
				CalcTimes();
				dPWM1 = Tb;
				dPWM2 = Tc;
				dPWM3 = Ta;
				sector = 3;
			}
			else
			{
				// Sector 2: (0,1,0)  300-0 degrees
				T1 = -Vr3;
				T2 = -Vr1;
				CalcTimes();
				dPWM1 = Ta;
				dPWM2 = Tc;
				dPWM3 = Tb;
				sector = 4;
			}
		}
		else
		{            
			// (x00)
			// Must be Sector 4 since Sector 0 not allowed
			// Sector 4: (1,0,0)  180-240 degrees
			T1 = -Vr1;
			T2 = -Vr2;
			CalcTimes();
			dPWM1 = Tc;
			dPWM2 = Tb;
			dPWM3 = Ta;
			sector = 5;
		}
	}
	
	TIM1->CCR1 = dPWM1;
	TIM1->CCR2 = dPWM2;
	TIM1->CCR3 = dPWM3;

	return 0;
}

int DAC_init()
{
	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_3);
  	RCC_APB1PeriphClockCmd(RCC_APB1Periph_DAC, ENABLE);
  	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_DMA2, ENABLE);
  	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);
	
	// Configure DAC channe1 and DAC channel2 outputs pins //
	GPIO_InitTypeDef GPIO_InitStructure;
	GPIO_InitStructure.GPIO_Pin =  GPIO_Pin_4 | GPIO_Pin_5;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AN;
	GPIO_InitStructure.GPIO_OType = GPIO_OType_OD;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_Init(GPIOA, &GPIO_InitStructure);
	GPIO_PinAFConfig(GPIOA, GPIO_PinSource4, GPIO_AF_TIM2);
	
	
	// TIM8 Configuration
  	// Time base configuration
	TIM_TimeBaseInitTypeDef    TIM_TimeBaseStructure;
  	TIM_TimeBaseStructInit(&TIM_TimeBaseStructure); 
  	TIM_TimeBaseStructure.TIM_Period = (9*1000-1);
  	TIM_TimeBaseStructure.TIM_Prescaler = 0x0;
  	TIM_TimeBaseStructure.TIM_ClockDivision = 0x0;
  	TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_Up;
  	TIM_TimeBaseInit(TIM8, &TIM_TimeBaseStructure);

  	// TIM8 TRGO selection //
  	TIM_SelectOutputTrigger(TIM8, TIM_TRGOSource_Update);
	
	// DMA2 channel4 configuration //
	/*
	DMA_InitTypeDef DMA_InitStructure;
  	DMA_DeInit(DMA2_Channel4);
  	DMA_InitStructure.DMA_PeripheralBaseAddr = DAC_BASE + DHR12R2_Offset + DAC_Align_8b_R; //DAC_DHR12RD_Address;
  	DMA_InitStructure.DMA_MemoryBaseAddr = (u32)&data;
  	DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralDST;
  	DMA_InitStructure.DMA_BufferSize = 19692;
  	DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
  	DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;
  	DMA_InitStructure.DMA_PeripheralDataSize = DMA_MemoryDataSize_Byte;
  	DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Byte;
  	DMA_InitStructure.DMA_Mode = DMA_Mode_Circular;
  	DMA_InitStructure.DMA_Priority = DMA_Priority_High;
  	DMA_InitStructure.DMA_M2M = DMA_M2M_Disable;
  	DMA_Init(DMA2_Channel4, &DMA_InitStructure);
	
	DMA_Cmd(DMA2_Channel4, ENABLE);
	*/
	DAC_InitTypeDef DAC_InitStruct;
	DAC_StructInit(&DAC_InitStruct);
	DAC_InitStruct.DAC_Trigger = DAC_Trigger_Software;
	DAC_InitStruct.DAC_WaveGeneration = DAC_WaveGeneration_Noise;
	DAC_InitStruct.DAC_LFSRUnmask_TriangleAmplitude = DAC_LFSRUnmask_Bits11_0;
	DAC_InitStruct.DAC_OutputBuffer = DAC_OutputBuffer_Enable;
	//DAC_Init(DAC_Channel_2, &DAC_InitStruct);
	
	DAC_Cmd(DAC_Channel_2, ENABLE);
	DAC_Cmd(DAC_Channel_1, ENABLE);
	
	
	DAC_WaveGenerationCmd(DAC_Channel_1, DAC_Wave_Noise, ENABLE);
	DAC_WaveGenerationCmd(DAC_Channel_2, DAC_Wave_Noise, ENABLE);
	int i;
	unsigned short data[] = {4020,3346,2283,2369,1074,3692,1599,2587,2939,3479,42,1549,2099,1099,1879,1237,2330,2092,2204,2619,2270,2809,3212,1493,3622,2654,2006,870,2984,4081,2867,2713,18,407,874,3849,1554,222,2302,139,1121,2915,188,2720,3506,2828,2864,1318,167,1374,1344,951,2042,3095,1934,1543,2646,3299,1705,1977,2671,377,859,153,1764,3965,2634,1073,2674,2223,1066,615,3026,2745,1448,1723,3497,3891,3983,2285,3750,3057,3669,3235,2438,674,2797,405,1265,226,2517,900,925,103,3032,2573,1049,1750,3484,2282,305,1534,1987,4031,431,2921,3869,2623,2071,225,1090,23,808,3095,1003,1264,3456,3756,1737,2208,3592,1611,379,1720,1826,3260,1226,1781,1985,1953,3423,3314,2672,2235,986,2163,1527,3476,3323,1323,3308,4084,2411,2725,3598,1439,1506,3277,1018,21,2818,2838,1417,3375,3481,355,1343,1671,3618,1858,492,478,2434,123,1581,214,2142,3236,2218,297,3906,1918,3112,3198,3849,2232,3927,2186,1099,1017,3299,1787,1993,2313,2934,1405,3601,887,3507,3527,2062,2819,618,1422,552,868,1081,3711,1359,3137,2520,1576,1538,330,1515,1662,1309,2623,1811,1254,3877,2726,2107,847,3308,600,4062,3893,786,3316,174,638,576,568,2412,687,1870,1485,1221,375,2733,1882,2402,3233,316,655,2566,3540,2965,3882,1362,2741,1663,196,1523,1282,2701,1827,673,2663,3196,3576,3584,1180,3319,3297,1745,2355,2245,1942,1968,2557,2168,3551,1910,1156,223,2875,2200,673,643,1913,2548,2566,2603,1601,1577,3123,139,1882,991,1796,2639,1620,1497,1071,2084,2814,2745,2345,1726,2256,3370,2001,3761,4032,998,3554,1259,2896,417,1267,2518,844,1290,697,2649,2895,2255,2258,3846,781,904,1306,3228,1593,2074,281,949,3199,1268,657,280,2442,1284,2867,3430,3374,3793,2217,3424,748,1297,1196,430,644,1667,1246,1783,4029,3540,2799,1518,2589,429,1179,834,3446,1201,2953,4028,357,1458,1404,2019,2484,3916,1011,1161,1527,2087,1259,2654,481,760,459,2539,1343,3727,102,4087,907,1368,619,1348,3241,3645,1414,3697,3115,3024,879,3127,2527,3300,440,2863,2382,3076,562,1049,2621,4089,647,2997,2143,2903,3168,669,2895,3310,1391,1400,1753,3916,3924,3350,2705,2360,2027,3593,600,3430,2235,2328,1453,2681,1911,2796,2120,2859,1519,3095,2543,1573,430,374,1572,3612,1131,2997,1235,432,1003,1898,2455,2990,460,3398,1029,686,3003,538,4078,2404,2941,1647,1263,3713,1704,1803,1714,3265,3833,3201,1293,2765,558,2992,2929,2905,2525,1330,476,3318,3017,1469,2998,2672,2450,1523,2261,2703,244,2692,1259,4056,2966,1066,1941,2316,3899,3995,1181,214,3459,1401,2968,3552,1049,2659,2103,765,3252,3892,584,3759,3353,129,3413,3009,1750,1806,2338,220,1960,1896,353,180,2356,619,3520,2554,320,1180,488,1867,378,1742,3487,3950,1933,3471,3173,1288,3346,2475,1561,1755,2012,1991,3668,3953,2441,149,1242,1427,4038,2245,1359,3079,1097,256,1887,332,3272,1550,3747,62,2799,128,2817,3943,3164,1301,2059,411,2774,1159,3438,1386,3072,2925,3795,1424,425,650,3087,2246,2398,3723,165,433,3269,27,1106,3856,433,993,2798,2945,2483,703,992,3532,678,275,2841,2181,1536,4041,2087,2668,2471,2949,3778,3630,3896,3324,3728,2660,1104,2250,868,482,694,4011,1225,856,13,3654,1674,2387,3589,3419,2108,2731,2649,395,1424,2533,3761,2959,1620,1489,192,2078,3601,2348,565,4043,3246,2686,205,1891,3482,3210,1565,3985,2228,3587,2011,1291,405,2452,1989,101,2035,1510,903,1644,1934,1485,1223,1979,2021,1994,331,265,3297,1689,2720,2839,1559,2290,3747,2676,3913,410,1755,4091,4,3858,2331,2098,3089,3125,1763,3052,806,4012,3614,4022,229,3085,2116,1116,3323,22,2872,1652,2849,1653,2186,3776,2829,1506,3556,527,2128,273,1311,203,2759,1699,958,2010,1549,340,2944,4048,2502,1998,2592,3450,420,3251,2375,355,1397,3797,3736,2129,2241,2240,3025,2807,2911,332,3759,3571,2271,2831,201,528,2303,1192,2002,996,3945,2259,1418,3121,3026,3690,1948,4006,2540,2017,1952,3806,355,1031,2921,1695,1505,3466,1175,3979,1837,2834,212,3680,214,3924,2537,970,2731,2319,1385,3182,2102,721,1283,271,2394,866,1651,1596,2459,3445,880,3279,181,4013,445,350,610,1204,715,3227,3671,852,1140,822,54,3616,112,1513,4028,1002,3154,362,114,3918,2538,3659,591,1764,1747,331,179,3441,3269,2853,907,453,355,2190,3682,3693,1645,538,269,2560,2445,3190,1821,1892,1132,2189,2096,1337,3277,711,2111,3611,1103,1012,1711,2242,2206,195,3906,2036,881,2544,2502,2625,2700,3103,2515,2677,3965,4085,3856,3880,1,2623,1373,2847,1503,2951,1065,3322,1706,149,3932,3942,1043,538,1660,2348,3027,1204,1354,3295,1939,2352,885,2352,3350,3106,1188,2300,3580,1629,2223,698,2047,3153,2821,2353,1208,3830,918,2847,2538,2772,1513,785,2372,2221,437,2016,114,3359,698,3104,2363,2261,136,3730,2323,2214,3829,2530,504,1299,3482,1208,343,764,2102,458,263,730,1639,4022,1708,388,3046,2379,1012,1965,2154,1312,1691,2531,1939,1529,2105,2288,287,2679,3729,395,2231,3400,2899,3158,3585,1314,3114,3568,3278,1226,2765,1843,3244,2753,3280,1190,340,484,1026,3866,2699,202,3615,2848,979,2601,1198,2432,1306,3248,3442,1761,472,796,2604,3062,2516,1030,2150,3453,2271,545,504,3057,1621,3151,3190,1080,1585,3308,2462,3829,2072,2784,1820,214,1948,2240,3736,2693,3209,1388,1478,2232,2682,2896,3683,1043,292,341,1565,340,3143,2560,1674,293,899,1057,1406,76,2703,2660,1160,1869,274,865,372,2805,717,494,1513,3071,1885,1163,1931,1761,652,1539,2073,1182,991,3344,1342,2468,1832,3158,2194,1758,1045,645,2040,2226,3661,2634,1265,2050,1416,2654,3398,2445,1382,1380,2720,3534,1445,2589,691,411,2558,805,1852,3477,519,1862,1481,1661,2434,2323,2064,3308,2074,1885,997,3480,395,3232,2775,308,1386,4037,2706,3215,3959,864,3310,19,1889,1570,1900,2230,225,695,3022,3834,2971,4071,1998,1967,835,71,1284,879,3973,648,2356,3823,1066,373,1564,724,184,920,2377,1018,241,3012,3201,732,3217,2202,1400,3122,1843,1223,1486,2268,172,1779,2878,3419,1148,483,3951,2647,2675,1078,2053,3240,1592,2217,1759,3296,1906,1510,2425,4046,2530,3743,2459,1547,1318,374,3318,3135,3334,2359,1340,2843,280,3195,23,1903,3374,3573,1824,453,2245,3159,72,1746,1975,605,3313,3946,2473,1695,2820,27,2636,3041,1050,2463,318,197,3559,2221,585,22,2584,1496,3329,109,1643,1517,3384,1135,3175,2455,2700,2796,494,3469,2214,3695,2192,2641,1868,1475,3609,1233,526,923,3088,3497,187,1687,2121,381,1772,2404,1123,2305,1126,715,3609,2276,1226,1360,3860,479,4023,4051,3333,153,2309,3313,2462,3509,91,850,648,3585,328,1467,380,551,940,716,3118,1742,2831,1314,1068,1176,1831,916,1858,68,949,184,3895,2716,2150,2894,415,23,2261,3570,25,2439,1238,3949,2161,2986,2043,595,1103,1819,2545,1381,2405,2176,3730,862,2387,2220,1380,729,484,3117,2583,1672,3264,958,1145,3372,3979,3077,2084,338,3075,3525,1229,2515,4037,3516,1557,2386,1175,3188,971,3696,30,1699,390,1018,1016,1309,3853,136,3569,3168,2034,1742,1984,3398,1009,1389,1785,1125,1748,1842,3420,2689,33,708,2179,1079,2984,2760,582,562,264,3583,57,328,1018,1797,1051,2572,1059,3235,2935,284,3381,380,38,1858,1788,1058,2009,2358,1268,3952,1058,4010,1776,2576,715,3883,2211,1717,3435,2165,442,1009,2502,2141,1486,3215,2460,1879,1189,1848,2664,2625,2528,1665,1538,452,3420,2393,556,2697,644,2622,86,3376,2364,4071,3693,3721,3350,3338,1542,3885,1488,86,3286,3012,1810,1144,1164,3360,163,57,2756,2015,3603,1565,2388,3243,1824,1268,1489,2108,3972,1899,521,819,1764,1050,2953,607,2290,3526,3079,1611,3418,815,2376,3004,2006,3809,1258,2902,2061,1957,3225,2534,2478,16,2588,2039,1129,1778,776,593,3061,1783,2330,420,8,1736,2575,2719,3141,2313,3967,3550,2136,3178,3884,2069,2043,3001,2742,521,2787,3469,4056,86,3250,1163,2123,969,1317,3955,2465,2278,2005,2306,1449,2177,1177,2001,2560,1848,1777,3747,108,1477,1739,3113,3698,208,1936,2800,1520,281,2342,479,1154,2880,1838,876,976,4095,2373,3687,2476,3053,806,3453,1959,2012,1174,1893,2923,2138,2341,3764,3760,3635,2209,587,1850,1563,1701,3238,1704,2214,740,1165,2726,2707,2306,3253,3307,3227,218,975,809,2901,3575,1126,3842,3988,14,1364,3648,3558,705,2380,2682,1813,3564,3792,2405,1992,1306,203,3279,2193,2063,1462,564,3679,622,117,876,2476,3027,3978,1561,1871,2089,3535,3052,4041,1763,462,655,2026,981,3644,955,108,1707,472,1298,1494,783,1887,2132,265,2214,1370,2876,1684,802,3741,1875,1842,2640,455,619,3993,458,2439,3620,2156,2357,3220,2104,1624,3154,3475,2641,2585,734,2900,2593,101,101,83,2391,494,1194,873,1455,819,2927,1851,2225,1325,3122,2681,2111,1109,2780,1998,1514,2427,1778,1509,3948,2367,3142,1905,3694,1099,630,2866,2210,1893,3370,3014,4040,2848,3113,4068,396,1114,2820,2625,1924,910,391,2445,1909,1410,861,2149,782,760,43,3473,2042,143,931,2998,4080,3810,1394,388,149,2759,2400,2472,2983,3296,3845,2777,3794,2523,529,1997,958,612,2625,3860,30,800,2895,2954,1440,1250,1217,952,514,3145,632,2674,3817,2558,3057,3657,507,2729,1286,2553,3317,1804,3437,1082,3476,965,166,4017,3438,431,1679,2847,568,3391,673,287,3489,3913,1235,2139,3444,3195,2213,918,2888,1392,1509,369,3282,1789,45,3273,945,2470,1825,3078,3535,568,1683,540,1156,351,1569,3469,3525,960,2420,2307,2848,542,81,2904,2656,279,1627,1825,1326,343,845,2861,284,4002,2739,505,4074,1197,3169,589,3924,1284,1016,3823,2321,372,2359,1630,708,1713,4038,886,3613,3423,1868,3281,2231,2604,2936,1331,3177,3506,1034,2875,3784,1241,1194,2456,402,2081,3341,1776,612,3162,2262,1560,2835,542,4018,1442,293,1556,1401,73,1640,270,2466,3253,2183,1946,2062,3500,283,2691,2122,445,1510,1648,3601,934,2217,1026,2342,2589,1774,2057,1308,1993,2684,798,2480,2921,2312,488,2716,3994,1073,3370,1909,2836,2482,2434,3084,140,835,1994,4095,3746,1655,1145,1784,35,1325,2145,171,2982,3282,2081,2266,993,1883,1155,1811,1940,2654,2605,3887,347,1897,435,180,2015,3159,4066,1906,3556,721,1397,2840,538,137,3826,3903,3871,1808,1324,940,2986,1072,3266,1008,2672,416,1661,2026,2594,1286,3796,802,1403,30,3769,1391,788,119,2748,2640,1442,4053,902,2453,3046,1022,1517,1782,122,3697,2661,521,2585,3336,1484,1679,2934,2412,2252,3109,819,2367,11,1686,3098,3618,1069,1414,3253,1520,2559,1191,2008,2624,539,2966,3108,213,2362,3614,1093,2880,2059,3042,1780,1867,832,149,1764,3741,2944,997,695,1756,3476,2426,1304,437,525,281,1233,3316,3499,1638,1157,561,278,268,726,1838,2311,1205,2703,3469,3631,296,585,759,1324,516,3257,309,3770,3848,2206,3546,1950,3037,150,2741,2139,2073,2904,1362,1472,3981,2970,1927,135,2534,4091,1770,1349,2765,824,1336,3247,489,3082,30,2946,2795,3332,307,617,3472,1272,3674,3593,3473,3714,2323,1814,2693,90,3898,606,44,3349,2628,92,1571,915,39,3557,54,3680,594,941,3591,1078,3759,1601,2890,1991,3767,1660,3996,1990,2125,229,3782,3806,3312,3663,2157,952,2684,854,2099,2328,2696,166,1509,3486,711,774,1326,3064,1258,792,1441,2781,3755,1401,770,3314,2466,2806,1308,263,2962,51,3946,425,1595,3556,433,1425,1848,2247,1970,3954,2081,358,2332,3597,3801,1176,2438,3070,3296,2784,2216,4079,16,2347,577,3219,514,4084,3568,171,2153,3058,3967,1747,1268,1527,1649,1492,1375,673,3754,67,817,667,4022,1262,1117,652,3407,3684,2644,2869,1834,877,752,309,2281,1708,2009,1367,2633,1730,3746,1074,3827,3725,2331,1670,1710,1171,1263,244,3338,2971,3014,1077,2485,579,835,3312,136,841,3382,999,265,1365,1866,3529,1785,2860,2822,2848,2566,861,3677,2259,3560,2213,689,3955,583,446,1530,928,722,330,434,1588,1848,1547,3004,982,801,2717,1415,1303,1636,1465,3342,3766,3201,2563,3001,366,3399,1626,1899,2533,3150,1325,452,221,2396,3411,2144,2774,18,353,1301,2233,2095,54,3463,1821,1354,1105,837,3747,1835,1160,1084,1052,2417,865,2514,2081,1004,4027,2555,1896,2595,1060,1590,2725,3037,1876,3167,1653,1211,3086,1533,2978,3210,213,2244,1749,1748,131,1666,189,878,450,3284,3580,3562,1846,1377,3913,3573,3999,1533,349,1896,1418,38,3305,2506,4032,424,1677,219,259,1083,3841,1097,2022,3443,782,1997,3877,3885,2853,2829,3448,1767,3124,2491,1395,3687,1751,2930,1510,2897,1971,1054,2400,3956,1947,804,1719,2172,2830,1124,128,4064,725,3981,1403,2964,2968,2103,54,3383,3609,3625,1944,596,3830,3315,3622,1235,3817,3188,657,2615,2714,52,4020,1089,2746,2041,3081,170,1016,3941,2659,2331,1807,3636,2403,823,164,2065,966,190,2410,3233,36,3915,1553,1972,321,2213,1873,218,1486,640,2514,3018,2152,3707,1606,2107,4054,2626,348,478,3773,4012,3005,80,974,1085,529,1883,2485,2468,3385,1701,1835,3500,421,2526,3795,2557,62,2212,3951,1083,1419,1729,923,3620,2639,1001,527,1380,808,3007,3471,931,209,1488,1181,3749,15,1558,532,2055,2405,3077,3229,3447,434,879,1741,2235,2432,994,3955,3943,3494,311,301,843,1718,2819,690,481,2414,3337,1720,1313,1641,3797,3054,655,2670,1088,3298,3034,3614,3297,122,3773,1577,1145,2365,1248,856,676,1514,1031,562,2846,318,3520,2970,3482,449,4071,1053,1483,2648,1029,3175,2893,2451,4059,302,475,2606,1306,2868,2346,707,365,3864,3307,1557,3723,3460,1227,725,520,831,1141,959,3523,2282,2973,3931,3912,821,1508,2175,94,714,2858,3515,1689,1120,3814,2523,968,184,238,903,1414,3169,3285,3428,1420,2086,2646,1586,2443,189,3388,2206,805,3752,1291,2881,35,1719,3463,254,2606,2467,3691,2118,1754,1042,2897,3062,2021,3768,1039,694,2843,3635,1063,3882,2563,845,853,4083,2673,2716,1379,4093,3588,3284,2534,1457,616,3762,3217,995,341,240,1312,2372,125,38,1868,128,383,1302,684,80,537,1134,737,2903,3056,3785,4056,55,1241,237,3338,2491,3650,892,2622,3725,1576,2853,787,336,1521,2227,3929,198,897,2235,680,1930,120,1009,3238,3173,2689,3843,2340,491,2900,2746,4031,1774,2195,942,1042,1528,1038,642,1521,1492,2881,3074,270,2340,2052,219,3318,3754,9,3506,3428,243,1248,2873,555,1765,1124,3616,1742,759,2093,1809,779,1032,1503,721,2714,1189,3896,2564,3360,2950,469,345,1633,2927,1948,2424,3592,754,1522,3865,1952,3307,3781,2815,781,4049,4017,423,3025,3706,621,1020,2522,1925,3213,3701,130,1456,4033,2548,4044,4019,2531,2840,828,2082,1163,650,638,3517,1389,3314,348,2866,3624,785,3947,1848,3192,2471,2156,1124,2563,317,1038,390,3230,1691,1530,2379,1495,594,3540,587,859,2368,1919,3915,3809,3074,2664,3836,3643,1868,2664,3064,746,945,1829,3322,2729,1536,3152,1221,3872,3811,422,506,1569,2833,2754,3893,332,812,1880,863,3662,3042,810,220,1740,1534,1478,1693,123,3575,756,3886,3354,3262,2667,311,2629,1747,1995,3997,434,3359,691,2257,2342,3081,3851,1966,575,3172,3145,718,2714,765,1598,3300,3086,64,1176,1186,3117,291,2785,1219,3256,3640,2317,1007,2906,3118,2719,1245,443,2991,1859,1563,1421,2402,691,647,2176,3608,3237,184,2145,3697,202,851,3765,2839,1743,2345,321,193,606,3286,452,2064,812,1283,3546,1491,1243,1140,3881,2725,3896,2520,2918,828,1500,4046,1104,2106,2174,3341,1938,3695,718,1082,3811,1619,3194,1044,4072,3279,2363,1882,3151,2676,2215,1170,436,1025,1695,3729,2558,2576,2705,1033,2738,2423,2149,3973,1437,2761,4019,1997,2125,709,3130,3991,3191,517,1433,1410,2016,1359,3960,1100,3127,1350,2478,668,1816,1688,4027,807,586,2575,2414,1181,895,3123,2671,427,3129,1478,612,265,2642,2949,3358,1372,1906,3627,556,3412,2395,2608,1333,941,414,2165,1537,3841,3558,3496,95,547,2059,2645,3007,2980,1439,2897,3032,1600,2131,2367,129,2208,3537,2254,1387,1416,4082,2727,531,2968,1080,2946,2659,1406,3171,1057,3552,2529,1583,2322,2140,2966,2867,2847,356,2350,305,1760,3266,3412,2523,1302,2586,3778,731,2672,1327,59,1497,1960,1422,64,2183,2389,3825,2510,3239,2106,300,829,4050,2292,1985,3953,3024,3167,2702,3355,1606,3808,3356,1736,209,2426,3856,847,2367,155,3164,1349,2341,1310,3182,2939,1625,922,783,125,600,1216,4067,2803,2815,3408,3774,3507,2532,3571,1819,1900,1212,849,3286,698,3382,1595,3970,1607,285,2863,2785,1239,2553,762,1714,3337,3468,2608,1677,2459,3448,2484,2567,293,1926,1557,3331,1660,1374,13,1837,2111,3237,1075,3072,268,3865,2921,2912,1963,2645,2605,255,3791,2082,314,1130,1290,3618,3415,2411,1321,3589,1829,4007,1474,1415,851,704,2476,3663,652,2708,3958,3584,407,2730,477,1641,2308,698,1929,1303,3476,3700,815,961,4080,1430,895,2106,3311,3018,805,1025,3315,164,2267,1267,1275,6,1860,1189,1409,382,3360,2253,2907,2229,1309,793,3869,1392,1475,308,1396,866,518,3303,3883,2615,2151,2996,2264,3464,913,3963,2894,3372,2654,1496,2827,1188,3922,2162,2282,3020,318,3340,385,1584,2749,1350,3475,931,648,3803,461,4040,2884,867,3787,587,945,2224,323,3783,1660,100,502,1281,2637,2088,1429,202,472,2485,3257,2463,3022,2749,1064,811,731,3281,1158,3394,3496,3548,655,918,3834,1877,3792,3508,1407,3871,1582,3958,3014,1722,300,2146,2215,3042,1160,1096,3781,2142,269,2758,3266,449,817,3990,3417,2539,998,605,1860,3655,1979,3804,3366,2253,3915,3233,3489,3808,1899,3973,896,639,2239,1839,1404,278,2036,3902,1561,1149,1462,3937,1064,599,3770,2913,2646,3155,2995,724,3914,60,320,394,1466,1947,58,3842,3141,2082,1321,3861,3512,930,2255,360,188,1973,4042,429,2020,3587,2772,1904,514,3167,1701,1709,2498,1097,3070,3783,1484,908,3934,2977,2229,976,415,1240,365,2775,3928,3605,2656,2627,332,1805,2663,4045,3080,2931,1063,1294,103,772,1616,4041,2832,344,2974,413,1189,1575,2729,2133,469,3360,1591,3466,873,3585,3303,1791,1513,3188,2423,1618,550,2095,654,2368,3264,3250,2769,2416,1648,507,272,3221,3053,2932,4072,1135,1482,2290,3585,3721,2245,1575,3600,1211,1448,2751,3797,3224,2298,2644,2813,2000,2958,1197,2320,1085,481,1401,3058,2904,3310,1111,564,740,2348,1280,1682,3232,3932,1850,4037,1591,1071,1686,97,2370,2125,2769,1847,2964,2173,1941,3810,3787,3394,3239,3613,148,2955,1432,1930,2710,961,2599,2522,676,731,3597,4043,2638,348,238,3,3904,1009,3709,3385,2880,2918,3687,1563,1026,1105,1109,1351,2853,1924,13,389,3670,2446,3376,3465,1883,2857,892,2020,3015,2300,1673,2915,3435,3016,1550,3757,2514,2109,3533,1127,2755,3829,1361,2898,1506,3254,134,3611,3325,2595,3823,872,3473,3083,3135,3552,389,742,36,3153,3692,2957,3686,2410,1510,3746,1691,3010,1487,226,1156,1550,1965,761,4032,1805,308,397,3094,2397,1075,1344,2350,951,3655,736,679,2253,2342,2841,64,1858,2676,2704,1459,2529,992,2553,660,1858,806,3585,692,555,509,1874,3490,2347,1544,692,1831,1807,232,2249,3816,624,103,3647,151,3602,3645,961,977,2213,4077,1540,3184,3270,1863,3517,2568,317,519,3992,2140,2223,2499,3121,3833,444,1087,109,424,1825,778,1216,15,4005,1009,3591,1519,3550,170,3294,2790,124,3801,3562,685,555,45,2542,3305,2468,578,1433,1373,2459,3839,388,932,192,3031,2695,2954,2481,2715,2340,3234,2885,2293,568,688,2049,157,1616,1375,3750,1847,560,2122,2559,3697,3724,2871,118,1031,4082,2517,1294,401,1869,3027,1592,3298,258,1259,3777,1962,1541,1186,1361,3940,2787,1768,3244,3575,71,829,851,2295,760,3416,1058,547,2968,1264,1474,1831,3797,1478,2776,442,3451,1911,531,1903,1038,3517,1584,2583,2883,2093,3543,1868,2038,649,2989,2246,2740,1166,3699,1081,33,470,213,2899,273,2597,2426,3009,546,2351,2857,3897,1038,1679,1120,2927,892,1519,30,499,2318,1797,1225,159,2419,1442,1318,268,1413,2388,7,2285,2523,1492,4070,2530,3847,2759,2990,452,2535,1008,1489,2606,2838,2298,3377,2240,3915,3473,3179,3916,3879,361,2598,2908,3961,35,2326,1720,204,398,2045,1796,4070,2354,375,3582,1386,1749,3132,2371,1558,1593,2801,665,660,3818,3174,3988,1946,1187,2855,516,3532,1833,3582,1923,2520,540,1917,2507,3208,3372,1639,3725,611,3072,1399,1897,1082,3679,2886,555,1725,4074,2712,2154,2694,2126,525,4058,3163,2870,3155,2618,1247,2149,49,1317,2225,2958,76,2643,2217,3134,2884,3976,336,3663,3030,1618,2936,326,2235,3197,3022,260,1174,2978,750,1303,3608,2434,3454,312,4093,2014,1088,1293,239,1073,3058,3160,897,2130,1328,3781,1668,2549,3263,4094,1205,2745,2867,4008,1195,2122,1352,2438,2315,3183,2987,1347,150,3260,2833,1691,1543,2784,3133,3362,9,1206,941,1193,318,967,572,1215,2120,3524,1167,284,4082,1150,858,2423,3830,1393,828,2447,2039,2691,1261,2292,2454,2377,1318,2942,3712,864,3207,179,3485,1702,4049,1108,2370,3234,4028,3614,126,2838,2256,428,3519,946,992,3762,1996,1058,1432,242,331,1565,3733,25,2299,3911,2971,4033,2425,351,1375,4000,2461,2560,110,2934,3037,739,3474,2785,3864,473,2435,443,3563,2132,3298,3945,3838,1085,3182,4060,1285,3886,2225,2722,3778,3768,3714,885,1760,1212,1668,2585,1033,3797,1396,2576,2271,1706,3053,2872,1045,511,1702,298,118,628,3665,2956,1194,1475,1965,1583,839,1428,835,2207,2829,1947,3563,1704,1719,3463,54,4078,3295,1299,3812,19,73,2008,2750,3812,3989,2967,59,10,1408,498,2110,795,2226,2226,1861,1001,3040,2417,3642,2561,3530,2544,2468,2364,2301,3008,581,304,1056,3260,3292,3470,553,1659,2531,1539,392,3746,1585,3674,3321,1790,2696,1559,2885,3372,2918,2332,3824,2756,2470,3815,1771,1464,495,2880,3490,3960,3282,3565,2541,1503,3886,625,3697,645,2446,167,2543,2846,2216,3098,1762,361,1359,1167,3124,752,1008,1463,3208,2461,1415,1840,1663,2785,1690,3268,1222,2205,4043,1559,3605,108,1513,3788,1328,3077,2462,3759,2217,269,1937,2378,842,305,2163,3683,2989,2622,244,2506,1143,1484,478,766,3191,2445,1959,3496,3674,1841,2866,2477,184,3171,301,671,1623,748,2595,27,3557,110,746,1515,513,1672,1045,947,2418,759,609,1334,1756,3937,3722,529,2273,411,1333,3597,2652,2867,3846,2224,454,2517,203,3531,500,1864,2846,1275,2453,2353,2725,507,839,317,2083,1151,1458,3353,2119,2090,953,1677,3003,1207,3039,811,3893,3538,2254,1187,2903,814,320,2225,1249,110,2057,2331,3197,3408,2985,2918,3793,3468,1773,352,1199,168,125,2230,662,645,2814,2831,2385,2754,1312,3613,1429,3334,2479,897,22,2329,3893,2310,3425,2698,2180,2132,3666,2329,1087,1821,3966,2173,3329,1778,2456,2125,2451,1469,351,1113,3241,3319,1900,1089,1252,626,2167,3003,3327,2014,3377,2656,2964,2758,2650,3087,887,1283,156,2118,825,3127,3212,734,1429,513,1790,2910,308,1086,1152,3478,2268,3173,1516,292,2843,72,1994,2513,719,409,730,1843,1647,3569,3020,1291,2258,3864,843,2791,2214,2739,1564,3247,136,655,3265,2523,1841,1050,3115,3658,3941,2361,1218,395,1989,1921,894,1878,2813,193,208,3938,4006,661,408,1391,2195,1700,1647,268,1142,689,3084,1505,3578,2155,2818,964,3001,1407,2111,1639,118,884,1069,1366,2771,2108,2979,1116,1435,1385,1875,797,1879,2212,3052,3388,731,2981,2568,2693,1737,1057,3694,3731,3531,965,432,2346,3740,2111,2220,1531,3054,2868,1021,3222,1108,618,73,178,680,3966,1588,549,3444,44,2714,3201,1931,3613,3591,1907,3983,3827,3377,1717,28,1166,219,2555,4090,3177,3474,3304,462,91,1074,1849,1096,1529,321,3224,548,3825,3473,3257,523,2335,3505,830,1698,3579,635,2005,3769,840,2165,3655,1244,2756,2147,1593,4019,541,1778,2910,548,744,1261,1361,2735,763,3786,2030,1055,995,3420,681,1294,893,1361,339,48,2895,1892,3003,1094,270,43,1369,3067,1641,2152,3555,3576,2347,1226,315,3298,764,1532,1773,1929,2414,2228,660,2170,3651,1428,1045,1660,3908,346,1777,1078,1530,3250,757,85,2087,1089,3019,1433,1932,218,265,2712,435,1804,3712,535,101,1921,3054,2759,2372,3855,3275,3907,3601,1593,237,1622,3206,477,1014,674,3626,629,3491,729,2242,1257,430,406,3613,442,3996,1459,2982,3511,846,451,2885,2443,1090,1143,685,475,1634,2188,861,3931,2354,1194,2865,1720,2164,2934,961,2222,3014,3007,720,482,1777,18,2572,2823,2475,3897,1811,2268,3956,3030,939,3066,43,1179,1383,281,3944,1076,3591,218,3298,362,2887,29,1114,3777,1758,3932,3437,2840,1631,2908,2996,270,2938,3265,3861,1850,1002,2153,786,81,2407,3790,3960,2866,404,3256,2016,620,3632,2775,3103,3221,3287,3547,1960,3203,1873,1646,616,229,817,311,4071,1113,582,1784,4092,3479,571,3168,3624,3922,3225,536,569,2109,1842,1239,4039,754,967,3393,1704,1595,4050,2,639,1212,1338,3559,2775,3365,2452,900,907,2595,3743,2461,3136,638,487,1247,167,2235,3393,1495,2142,2986,1603,2393,1838,1528,3788,2072,3262,3660,1094,1715,1197,1884,154,1508,1722,4040,2411,578,1710,604,71,1198,1039,1457,780,440,2701,3211,2896,2571,503,1419,3798,2651,3574,2925,3903,2924,3631,1225,2597,460,3652,1124,2400,3654,1554,2286,659,3456,2338,3333,1918,2109,1850,1919,1452,763,3052,2770,1749,3748,3845,1519,204,1998,1070,833,1296,1821,2845,2480,382,351,3939,3043,4011,1822,2269,2168,1357,1313,2838,2604,1026,1065,1490,1944,2470,2230,1203,897,4032,930,3975,3238,3107,403,2518,3476,96,2892,871,3347,2609,1355,2026,3529,862,91,3853,3684,362,2354,3194,2467,1557,2178,4070,1581,3882,747,1267,1702,1585,2341,877,2512,253,2025,3838,2646,301,2008,1853,3809,1134,3488,2025,2598,1142,2589,2209,2772,1769,2484,3407,2985,3478,1369,1382,828,1544,392,3242,1091,2568,3870,2759,3453,3897,2720,887,2440,1881,3297,1647,3882,5,2703,3905,250,756,1076,1482,3511,1513,1704,3459,14,2677,2716,1619,3751,3681,1183,3018,3143,2886,1404,1429,1934,1783,2504,1919,2856,755,2647,285,3551,3351,3014,3600,566,3833,3777,1606,1805,3677,13,3384,1762,3282,2125,699,2205,2084,3103,593,3762,2569,3151,984,2066,2071,1378,2776,3896,1036,74,1832,2814,2963,391,1128,3560,2148,2514,2615,1719,50,1507,3165,54,1181,3691,2688,238,864,2057,81,2980,1571,887,1407,3849,681,3452,3505,1479,2690,3739,2239,1673,2953,2977,536,1026,3909,1353,412,3299,2937,2090,2802,3049,471,3318,3521,1979,7,2155,1465,766,4019,2852,2714,3171,1710,488,10,3766,1655,1384,1442,143,3305,2612,1857,1155,924,293,3189,2435,51,1746,2295,2587,1150,1022,3198,3298,3609,3383,666,1231,1738,839,809,48,1045,725,436,2579,2010,1171,3601,2288,4019,3392,977,3980,1353,3446,2738,3222,3695,508,1645,2732,3220,868,1687,149,3492,1660,1762,247,2870,3039,3884,2689,2830,51,749,2016,3755,3147,492,4061,1016,1206,2010,1275,1149,2637,3171,1548,1533,2439,834,3516,2600,2886,3116,675,3738,1066,675,1942,3353,1228,3715,2868,2905,2547,903,2092,2810,3169,308,1316,2470,164,858,1234,279,1912,393,1526,1805,3459,3992,827,3355,2966,3374,828,266,1601,1500,2236,3186,3646,367,603,1302,51,897,2775,3239,1251,3047,2279,207,252,1587,3872,2854,1305,2594,3154,384,3584,2910,2842,1419,1107,2460,544,1236,3266,125,1081,2353,2069,1983,4069,2118,741,779,4081,963,1507,535,2837,2386,1485,133,997,685,831,1568,2322,1381,2798,1668,1400,858,1421,374,3984,2600,1995,646,2606,870,610,371,995,1256,504,502,1931,93,3919,931,3006,832,3831,606,785,1945,442,1427,3157,715,1086,299,565,1703,3877,1228,2923,214,1854,3080,2714,2833,3364,3739,3683,2828,3468,64,387,596,298,188,2754,3767,3227,2959,3236,2539,170,2169,1547,2452,2558,2881,369,3922,313,910,1456,2319,2842,3297,1389,35,2122,3896,3911,2690,1409,3611,3579,2507,2913,2336,2114,2969,3767,3129,191,2484,0,3795,1572,2496,3104,1224,813,3467,3003,3517,3681,658,879,1347,2727,683,999,840,1694,890,2536,2886,3298,1711,3621,3345,1084,2533,1341,1099,3889,1779,4074,2194,3232,893,2755,3519,1847,290,3754,856,1438,3487,46,1309,2664,681,4088,2765,1112,1493,2767,2033,3640,2289,2375,3182,3714,2475,60,965,2090,424,42,1477,2464,1693,1512,1558,3521,2600,2566,1135,2853,2582,341,3167,1153,13,3198,1446,2197,417,2072,1052,510,178,3301,1847,1875,2779,3988,2760,2954,2499,223,1644,3347,814,3437,3566,1722,2220,3536,226,3896,2039,1782,2826,2321,2775,2410,1027,821,1760,450,3991,2082,3553,2273,3436,3743,3445,870,2338,2385,3909,522,2695,1785,2322,340,1317,546,3214,2582,2257,422,1874,256,300,2088,808,1723,1493,1097,1441,2045,2707,198,142,3435,3869,1095,394,2992,3829,400,588,921,519,1842,2185,444,3037,9,1518,3786,3133,671,2072,3971,3767,406,2271,1153,2842,3008,3524,2714,1295,3033,2201,2625,3115,2153,1801,2148,3136,1078,698,1438,3322,3582,353,3717,517,64,1196,3051,2820,483,2648,639,954,1403,3067,716,964,2490,3930,2456,3803,2395,1555,4004,1205,2807,3570,2449,243,339,158,2056,2914,2862,939,1999,1949,774,2281,377,1352,4002,3570,2501,37,984,3215,380,4050,3623,2642,1302,2087,2380,2315,3429,2219,3056,1621,3879,3374,2279,3048,2807,3390,3761,3944,3466,3221,2091,660,3956,2808,3053,774,1427,1017,3227,2712,130,3940,2295,3787,3334,211,2989,352,931,2077,2916,34,2342,177,2786,1193,3659,639,2247,1175,4007,270,4047,429,1517,3092,1666,2453,1499,3908,4038,1543,29,618,2619,3255,343,2304,124,3908,606,747,2371,2922,1967,3005,1876,2767,516,2851,2368,808,3637,1254,2514,1588,1218,2221,4003,398,2700,520,3448,3821,29,2261,482,1030,554,173,1979,647,2406,2358,1438,2076,2688,3633,3646,3692,1603,1883,60,2875,2355,2111,1604,41,3109,162,1839,2800,935,3124,1410,1353,130,675,27,1222,3949,1962,377,2871,2300,2796,84,1592,491,2077,3967,3967,2790,1768,3468,3249,164,2808,1334,3996,3045,1042,3367,1485,314,3544,2066,2315,364,4086,1193,3832,2306,3623,3479,2390,238,2079,2437,1486,3503,2417,2871,3576,4095,2537,350,1945,1157,3362,1671,1134,1043,767,393,533,823,1764,1290,2611,684,189,4009,669,3880,1044,3107,3298,350,174,289,1742,3564,573,358,2535,1405,94,2964,3058,1239,3803,2647,3774,1213,3401,1127,4038,2477,1897,3177,2273,1120,1256,284,4020,447,2402,3375,1517,2603,1210,1848,2360,643,610,525,829,2929,2632,3133,2510,427,4069,150,3708,3525,782,1440,3825,1164,3925,3663,1270,1690,3192,2291,1597,167,3647,153,1110,2933,1057,3002,3341,2962,2591,3354,2569,473,1941,858,269,2768,110,2357,920,3913,1087,1380,3975,980,3754,2700,3697,2361,1931,1885,1577,3089,637,1651,2110,1325,3861,3752,604,2347,2340,671,3659,2215,2135,233,429,118,88,1106,3635,2363,221,899,391,1941,1399,304,1394,3150,1539,3098,3974,1020,1563,3789,387,1873,1381,1,2325,2845,4001,651,4083,4090,3213,1260,3008,653,4018,479,3643,2971,2279,45,1281,4032,956,620,2521,4023,2047,1866,598,2103,2362,2437,71,483,1841,4053,328,392,3494,3294,3857,1954,1079,3905,3924,262,3725,475,946,1639,3181,2851,2534,3155,2410,3582,2982,934,3407,2286,3752,2293,3000,1725,1145,1266,1129,3604,2790,3165,771,425,2981,4047,3909,42,3147,3071,3271,1094,3735,2464,2896,1188,68,3424,1679,1016,2810,2058,1556,260,1116,1571,3511,1619,3609,110,3357,2766,1533,2970,4073,234,1424,2130,3528,1911,692,874,2674,2320,3834,1367,1470,3200,2061,742,2845,1146,1956,3283,604,3982,882,4018,3878,2169,3367,1111,302,1508,639,3921,1063,2707,3329,361,4030,1334,656,1846,1965,106,1228,2427,2953,743,320,3286,1811,3922,451,529,521,1147,3082,1475,4085,3326,420,190,187,3957,107,1905,4061,3763,488,2774,1321,2393,3037,1908,1080,2579,4091,1548,3264,1961,3053,2878,2689,1185,2410,1972,1306,4059,3589,2117,68,995,2974,1394,2980,1905,4033,1050,779,3402,1077,1208,3576,1022,3741,1058,51,1611,169,2826,2419,2791,2052,3584,1383,1144,3686,3549,2991,430,2434,1832,3,3398,2823,691,537,3560,146,1308,3474,1608,1016,3871,2619,1287,2767,3394,2991,1250,1717,2166,402,3200,1414,1355,1958,3750,216,1131,1448,2549,3681,652,3875,2329,4062,2129,1002,714,732,2696,3984,2478,274,2523,2531,3187,83,722,1675,1512,591,3679,1325,3220,1137,255,365,843,193,2926,790,2223,3250,2641,3522,1883,2579,1660,312,1560,1665,1148,2327,1930,2994,1293,3358,2659,3945,1252,214,2413,823,3236,1061,2851,1255,284,668,615,3600,710,1000,3532,1141,3720,3010,2060,2503,3316,2529,2001,2976,714,2550,4062,968,164,942,3781,2018,855,2706,3906,2478,872,3737,2077,1719,1443,2867,3051,2261,2723,2109,2396,1451,3903,2370,2860,3816,3066,3607,2052,569,1425,605,665,2372,3264,3490,2459,2524,3644,991,1958,1394,664,1145,899,2561,3746,2882,4053,256,758,4087,2927,83,3160,1587,187,2424,861,3497,1700,2620,3265,541,4043,3126,2369,2842,2756,1321,1409,3195,633,1733,2613,1477,3411,3766,3083,713,3655,1714,3005,2854,981,1133,1490,643,2234,2422,829,2232,958,938,2171,2372,1893,3231,1591,3078,624,2552,2376,1160,4011,3462,2624,653,1455,1252,3565,441,1808,2505,1258,2488,703,489,3038,3668,824,3810,2938,3874,3891,3713,2189,2036,2405,2653,931,87,159,2106,2416,3076,3933,2470,712,2738,3158,3197,1080,2065,2656,2631,3708,3023,2060,2263,3658,2453,21,2509,3124,281,2340,2755,3337,3596,1517,1426,371,2076,1314,4061,1577,753,365,2883,957,3667,392,1408,3837,1489,2072,2123,2180,330,988,2359,3352,1078,3937,2581,1372,3692,384,2191,1550,2972,3292,3661,4025,837,23,243,3891,2399,1533,591,3359,3424,1302,4093,3626,2841,54,933,768,2617,1551,778,2151,3671,300,4060,1777,1851,2135,1973,876,132,3634,1134,3684,498,384,2954,1215,3884,3324,3784,3822,2025,1838,3028,449,1994,732,3189,3570,1676,3750,1631,39,2025,1367,2817,259,2918,3481,2134,1348,3301,2560,2038,3476,1027,2412,3956,1707,1129,1626,160,2347,3550,1938,2358,2513,3042,4057,716,2393,1619,3519,774,1096,218,3057,2980,882,2845,326,2656,2948,205,68,2276,3370,2440,1963,3296,1289,2343,567,2055,3028,3888,1665,2034,1626,1907,1869,1657,1301,2463,828,2351,1258,2380,1290,437,3694,1569,879,3557,1598,3086,240,1879,3365,626,3182,975,4056,3397,116,1243,1803,3085,987,2103,1868,2684,2361,1948,342,78,3900,2235,510,286,130,3397,440,3249,1011,724,1377,3767,3075,817,3492,3808,1939,1039,1832,211,304,1806,2719,1095,4001,2520,3240,1261,1419,1589,3596,2642,415,440,2915,2144,3705,3634,3470,3757,754,2365,2301,2281,413,3202,3721,3762,2364,3522,2778,977,1130,3774,1681,2045,2513,3314,1661,1734,3141,564,2856,2026,2661,1080,345,3875,3792,1182,434,3093,92,257,258,2674,414,840,4052,504,312,247,2812,1600,2549,3021,2831,1823,653,374,1194,8,3462,2985,2217,2279,2479,26,944,1349,437,104,3683,1257,3121,2638,3441,900,3079,1908,403,2210,4023,3486,1920,2095,526,3674,2027,430,2452,1909,1873,194,2350,661,1711,3415,3948,1390,632,2792,1786,416,882,2362,1666,1270,3672,1022,231,2311,983,721,1193,919,133,2429,3190,1606,3380,1961,3878,3806,3698,2291,3901,1767,1306,1324,2956,1061,3506,4091,3758,2135,269,2294,3917,280,953,3039,61,2064,1649,100,15,787,1531,2621,2414,959,2810,2335,787,1953,2571,2206,4036,2223,1018,117,3615,3165,1389,1134,2242,1147,1782,1055,1652,3748,3443,2874,2555,1183,2432,363,455,3072,2018,2684,2245,1687,301,1522,1420,510,2574,4000,2737,2029,832,3890,1813,3592,2425,2129,1364,1550,1387,2740,3094,3498,2999,508,3601,3717,3348,1494,2563,3664,1595,2587,2699,3805,4045,3650,1616,3493,3706,3626,22,1154,762,355,1679,2325,2566,2981,1110,3343,3134,3254,36,3611,3667,39,3261,1504,270,3525,2226,2594,245,2347,3776,3217,1755,525,1438,2775,1887,1053,4082,3740,810,1784,3195,3476,1796,3705,1478,2430,2959,2611,684,4085,1401,1497,1473,2722,1388,2329,3525,3942,2080,1963,1380,4019,1622,308,857,2403,1197,376,2613,1581,975,2,2251,2949,100,189,2470,2907,844,797,912,842,247,740,2379,3306,2608,2000,2394,3597,3020,1435,3720,2131,3662,3032,3966,2425,1636,1611,3808,2836,1241,3200,2958,745,1604,593,4086,679,871,1907,767,2057,239,1911,1853,3224,3977,2588,2899,1573,3033,763,2587,1618,3747,488,2590,2793,3221,630,3601,3441,1625,3186,1204,975,2198,885,2228,3937,3086,1845,201,3619,1360,867,3991,2492,1335,4028,975,1968,2135,4043,2061,2527,1909,868,794,3539,1854,1577,1962,3396,2110,4056,1134,3590,1865,1033,1009,409,3331,627,3342,1478,3627,1734,599,1094,2906,2241,670,685,343,3100,2174,714,2229,93,2705,552,1601,325,2986,2718,2711,1682,2682,433,637,1022,414,2367,1669,2333,1982,3796,2942,418,3999,3143,498,1353,2016,1820,1720,1996,2894,275,609,2225,115,2022,2494,985,2593,1358,3430,209,1786,3805,2579,867,426,1619,2149,2868,218,2395,3371,998,1869,430,2288,1350,933,1278,2186,749,158,1258,1163,3202,1232,3887,419,3541,783,3428,171,3716,2541,1387,3609,568,1061,2261,705,2231,2145,1357,833,3474,2403,1163,99,2215,1486,3137,1741,3454,2141,3600,3858,3023,1944,1986,3585,3913,1637,768,1092,4011,835,1404,3729,141,2320,198,1419,438,3682,682,3552,3782,1520,1246,2139,3964,3689,3319,370,1904,634,3268,535,1656,2268,495,3801,2085,1058,1538,2147,1062,813,3823,2938,3650,121,3621,194,1553,720,368,3304,1874,3317,663,168,2485,3448,1839,2199,225,3864,214,3464,3229,2170,3431,1050,2170,3157,1658,3318,3109,2409,452,1236,2920,2626,242,1126,1528,1464,432,106,1895,3680,3527,2410,1906,763,2761,3134,2499,3604,2662,359,3630,1684,2665,3524,38,3841,1129,511,1944,1561,3611,2720,2062,1674,2365,135,316,1803,875,2116,3796,2611,1629,658,2196,3792,1989,3126,533,3999,2404,3507,2860,793,2244,3047,3931,3091,4030,1902,1648,2364,980,3292,1044,1329,1766,1286,2043,1738,1664,1176,3513,141,3177,3151,3369,312,3652,2223,2535,906,3520,636,918,3610,2218,3700,1528,924,2169,3377,2236,722,784,2954,3978,1623,2574,513,2583,1268,2847,1381,1046,334,4075,1617,1315,2564,3636,393,281,2516,1963,4002,1916,1909,2539,1401,1038,1437,3770,905,3708,731,3005,1705,2672,2556,660,1914,1983,409,281,2716,475,3190,211,216,162,2371,1927,1749,1979,685,1764,1349,1742,3932,3221,232,2443,501,594,2631,1952,2376,3533,3625,1239,4081,152,1344,180,3241,2188,1099,1817,533,3890,3028,3972,3813,2652,2193,3534,3541,2987,854,396,1438,202,192,1649,2244,879,378,1097,1575,2368,554,3741,2149,1034,2963,1332,1573,362,596,959,556,2822,1845,474,2826,1683,1759,833,2956,1472,2516,1975,2651,1624,1281,2783,2586,499,2322,1093,2426,3636,669,2004,840,3306,2628,1297,3612,2994,1253,1997,3226,1073,780,1941,3475,3149,382,2100,2979,1380,2271,2398,3443,3425,3532,1701,1479,3565,287,1990,832,3226,3936,123,154,2873,369,122,1149,1908,3024,851,399,2786,3912,212,1678,2904,2191,3223,3625,2677,55,1633,3847,1492,2815,2531,3052,1869,2450,3771,889,1139,2229,2194,91,3829,268,1855,2378,1184,1844,1601,235,3850,3081,3447,1533,998,3072,122,814,1253,12,3808,3861,4034,3228,1161,3208,3620,650,2324,2582,1470,3707,42,652,2096,2324,2416,3203,838,1810,168,2750,151,2351,3470,3039,1510,3059,958,2690,1235,2127,731,3471,2841,674,1704,1931,608,3046,1746,1829,107,147,1810,1836,1753,2441,1821,3638,839,2904,646,3833,3995,1723,266,2084,328,2135,1633,1125,2607,2303,563,2676,2027,3361,63,3317,1043,1464,2067,2744,1162,3899,3465,3643,2785,635,55,3669,1218,1048,3021,3498,3060,1227,2057,2781,1581,316,2181,184,1274,540,3334,1476,1559,3097,318,3302,844,4064,3273,1198,540,2629,865,1977,1126,971,1213,3310,1975,305,3212,1731,1492,817,621,1032,1139,1650,2585,3946,1314,934,838,3999,1469,3963,2469,1855,4059,2716,1251,1287,2351,447,2218,950,858,3480,1215,2531,3094,707,1187,2628,3371,540,53,935,3116,2089,2846,154,2777,3501,1266,1990,1757,1862,2436,3070,2512,1470,97,3028,2453,1451,3426,531,1980,4034,29,1363,495,2270,1075,2123,487,364,369,2489,3415,1602,2946,1067,1534,17,538,3704,2392,905,220,2869,332,324,3939,2339,893,1545,395,750,396,2681,1783,3903,2339,835,2890,185,1050,306,1586,1582,2036,220,2919,2618,1649,2803,2735,901,3420,1079,3995,1235,1597,3376,474,3286,1735,711,1315,1577,202,3469,2366,1925,464,560,2490,927,946,364,3670,2326,3059,2007,2764,696,3186,3650,3744,1821,699,2397,1459,2297,2181,2465,1972,1788,900,3079,2108,3027,1398,2334,1776,3655,3064,1415,3986,236,177,524,2543,626,2421,2899,2433,3478,2002,2574,3612,2304,2452,732,851,1909,2115,1672,243,1925,2498,439,2725,1020,3985,3357,31,884,1930,3399,3314,2208,2870,801,2284,561,104,2864,1974,2803,2239,3639,2293,2431,471,213,2156,105,1415,979,3510,3713,2403,969,3231,3717,3882,2425,1210,1820,1159,2433,443,2779,802,1195,2925,2163,206,1935,1371,2751,3835,2782,3915,2120,2965,839,1260,979,34,404,3565,3073,630,604,3576,2956,1057,3666,1202,2351,765,2595,3579,1902,2179,1690,323,1320,2694,78,609,3322,2741,4065,268,1437,1724,2594,2261,421,2098,4026,393,4067,1275,3409,3762,2803,3734,2968,53,2478,734,3919,404,3703,2907,2303,2716,2112,3520,1407,3815,420,3038,3426,3641,333,846,1398,1078,2543,3529,3669,2184,2617,226,1206,3836,3289,3705,347,1813,2183,1065,2243,3237,4088,2969,3033,1882,459,2685,1809,2781,2238,628,848,1747,2936,346,1331,1807,3247,182,3429,780,2802,1628,2205,3750,318,971,3964,2417,1516,1774,1729,3902,3040,2365,3863,1948,458,139,1333,1587,583,3721,443,2793,1039,192,2410,320,2503,281,3307,244,574,1319,2277,3504,2035,3738,1562,1849,444,2845,2344,2351,591,1111,715,2866,2108,28,4025,281,3647,4091,2180,2667,2832,432,522,745,341,3827,3285,592,4062,3429,1438,3147,294,3784,1301,125,3063,182,4089,2713,789,3304,1781,588,1281,2335,1711,2896,3238,1772,1993,1370,141,1035,3858,3083,875,2610,3365,1809,992,3861,3784,2613,3273,1124,3229,1309,1198,1994,2882,875,3651,750,2947,3275,2137,2932,2565,1287,3468,828,3964,2996,1125,2000,149,3221,4056,744,3578,3925,3686,2616,1123,1952,2779,3966,3186,1338,3023,56,2805,932,1016,1627,135,2765,532,1884,2525,3629,194,1289,3996,3467,1736,3343,1664,1174,1725,2324,3892,2830,3935,3804,1632,1163,2908,4087,1237,179,348,2592,3873,2919,1044,1838,1520,3108,579,3237,1559,1717,1670,3124,2089,2766,1927,952,212,1025,2072,3238,228,2603,1739,3283,1262,198,3661,1518,1428,1976,1364,1410,1974,2689,3751,1399,3054,255,2261,2897,3777,3772,3754,2286,2339,893,1728,3019,4002,2787,987,3502,760,3244,1179,1099,4061,3202,940,322,3793,2585,1991,606,1204,275,929,311,561,2366,1514,911,1021,1571,2381,2822,667,1944,1125,1352,745,2365,2565,3117,1410,673,2269,1318,1837,1981,2939,533,139,2038,2214,149,1596,3886,787,2668,2297,1266,2402,1327,1417,3355,1616,652,1151,1839,133,64,2713,3824,2742,2049,2177,3099,899,3956,2814,585,1465,2135,2707,304,2047,70,3101,1169,3323,264,55,1049,};
	while(0)
	{
		DAC->DHR12R2=data[i++%8192];
		//DAC->DHR12R1=4095;
		//DAC_WaveGenerationCmd(DAC_Channel_1, DAC_Wave_Noise, ENABLE);
		//DAC_WaveGenerationCmd(DAC_Channel_2, DAC_Wave_Noise, ENABLE);
		DAC_DualSoftwareTriggerCmd(ENABLE);
	}
	
	return 0;
}

float norm_radian(float r)
{
	while(r<0)
		r+= 2 * PI;
	while(r>2*PI)
		r-= 2*PI;
	return r;
}

void DACWrite1(uint16_t d)
{
	DAC->DHR12R2 = d;
	DAC_DualSoftwareTriggerCmd(ENABLE);
}
void DACWrite2(uint16_t d)
{
	DAC->DHR12R1 = d;
	DAC_DualSoftwareTriggerCmd(ENABLE);
}
int main()
{
	log_init();
	DAC_init();
	//bsp_init_all();
	
	/*
	while(0)
	{
		pa1.write(false);
		systimer->delayms(1);
		pa1.write(true);
		systimer->delayms(1);
	}
	*/
	
	init_tim1();
	init_adc();
	init_adc2();
		
	F4GPIO led(GPIOC, GPIO_Pin_4);
	led.set_mode(MODE_OUT_PushPull);
	led.write(true);
	F4GPIO pb5(GPIOB, GPIO_Pin_5);
	pb5.set_mode(MODE_OUT_PushPull);
	pb5.write(false);
	
	F4GPIO scl(GPIOB, GPIO_Pin_13);
	F4GPIO sda(GPIOB, GPIO_Pin_15);
	I2C_SW i2c(&scl, &sda);
	
	F4GPIO scl2(GPIOC, GPIO_Pin_6);
	F4GPIO sda2(GPIOC, GPIO_Pin_7);
	I2C_SW i2c2(&scl2, &sda2);
	
	MPU6000 mpu;
	for(int i=0; i<10; i++)
		if (mpu.init(&i2c2, 0xd0) == 0)
			break;
		else
			systimer->delayms(10);
	//printf("MPU init=%d\n", mpu.init(&i2c2, 0xd0));
	mpu.accelerometer_axis_config(0, 1, 2, +1, +1, +1);
	mpu.gyro_axis_config(0, 1, 2, +1, +1, +1);

	
	mpu.gyro_axis_config(0, 1, 2, 1, 1, 1);
	
	F4GPIO pa0(GPIOA, GPIO_Pin_0);
	pa0.set_mode(MODE_IN);
	
	while(0)
	{
		led.write(false);
		systimer->delayms(500);
		led.write(true);
		systimer->delayms(500);
	}
	
	
	float phase = 0;
	int power = 550;
	int range = 4096;
	devices::gyro_data gyro = {0};
	
	while(0)
	{
		led.toggle();
		uint8_t state = 0;
		uint16_t value = 0;

		i2c.read_regs(0x6c, 0x0B, (uint8_t*)&state, 1);
	}
	
	float v1 = 100 * PI;
	float a = v1 / 0.5f;
	
	float v = 0;
	float pos = 0;
	
	// start
	pb5.write(true);
	int A = power * sin(0 + PI * 0 / 3) + range/2;
	int B = power * sin(0 + PI * 2 / 3) + range/2;
	int C = power * sin(0 + PI * 4 / 3) + range/2;
	TIM1->CCR1 = A;
	TIM1->CCR2 = B;
	TIM1->CCR3 = C;
	systimer->delayms(200);
	int64_t last_t = systimer->gettime();
	
	// ramp up
	/*
	
	for(int64_t t=systimer->gettime(); t<500000; t = systimer->gettime())
	{
		float dt = (t-last_t)/1000000.0f;
		last_t = t;
		
		pos += v * dt;
		v += a * dt;
		
		int A = power * sin(pos + PI * 0 / 3) + range/2;
		int B = power * sin(pos + PI * 2 / 3) + range/2;
		int C = power * sin(pos + PI * 4 / 3) + range/2;
		TIM1->CCR1 = A;
		TIM1->CCR2 = B;
		TIM1->CCR3 = C;
		
		if (pos >= 2 * PI)
			pos -= 2*PI;
		
	}
	*/
	
	pos = 0;
	//v = 2 * PI;
	
	int i = 0;
	while(0)
	{
		double phase = systimer->gettime() / 1000000.0f * PI * 3;
		phase = pos;
		pos += 0.002;
		double a = sin(phase + PI * 0 / 3) * 0.15f;
		double b = sin(phase + PI * 2 / 3) * 0.15f;
		double c = sin(phase + PI * 4 / 3) * 0.15f;
		int A = power * sin(phase + PI * 0 / 3) + range/2;
		int B = power * sin(phase + PI * 2 / 3) + range/2;
		int C = power * sin(phase + PI * 4 / 3) + range/2;
		
		apply_power(a,b,c);
		DACWrite1(adc[0]);
		DACWrite2(adc[1]);
		//TIM1->CCR1 = A;
		//TIM1->CCR2 = B;
		//TIM1->CCR3 = C;
		
		//systimer->delayms(1);
	}
	
	while(1)
	{
		int64_t t=systimer->gettime();
		float dt = (t-last_t)/1000000.0f;
		last_t = t;	
		
		float ts = (systimer->gettime() % 450000)/150000.0f;
		
		if (ts > 2)
			ts = 0;
		else if (ts > 1)
			ts = 2-ts;
		
		uint8_t state = 0;
		uint16_t value = 0;

		i2c.read_regs(0x6c, 0x0B, (uint8_t*)&state, 1);
		i2c.read_regs(0x6c, 0xc, (uint8_t*)&value, 2);
		swap(&value, 2);
		bool mag_detected = state & 0x20;
		bool mag_too_strong = state & 0x08;
		bool mag_too_weak = state & 0x10;

		phase = norm_radian(-(value*360.0f/4095*4 - 26 - 35 - 19)*PI/180);
		
		if (phase < 0)
			phase += 2* PI;
		float phase_hall = phase;
		float phase_drive = phase + 0.5 * PI;
		phase_drive = ts * PI;
		
		if (!mag_detected || mag_too_strong || mag_too_weak)
			printf("\ras5600 magnet error");
		else
			printf("\ras5600: phase=%.3f", phase_hall * 180 / PI);
		
		mpu.read(&gyro);
		printf(",gyro:%f    ", gyro.x * 180 / PI);
		
		float a = sin(phase_drive + PI * 0 / 3) * 0.05f;
		float b = sin(phase_drive + PI * 2 / 3) * 0.05f;
		float c = sin(phase_drive + PI * 4 / 3) * 0.05f;

		//DACWrite1(adc[0]);
		//DACWrite2(adc[1]);
		
		DACWrite2(phase_hall * 4096 / 2 / PI);
		DACWrite1(phase_drive * 4096 / 2 / PI);
		
		//DACWrite1(limit((-gyro.x + 2*PI) * 4096 / (4*PI), 0, 4095) );
		
		led.write(true);
		apply_power(a,b,c);
		//apply_power(0,0,0);
		led.write(false);
		
	}
	
	while(1)
	{
		//float phase2 = int(phase / (PI*2/8)) * (PI*2/8);
		//phase = 0;
		

		uint8_t state = 0;
		uint16_t value = 0;

		i2c.read_regs(0x6c, 0x0B, (uint8_t*)&state, 1);
		bool mag_detected = state & 0x20;
		bool mag_too_strong = state & 0x08;
		bool mag_too_weak = state & 0x10;
		if (i2c.read_regs(0x6c, 0xc, (uint8_t*)&value, 2) == 0)
		{
			swap(&value, 2);
			
			if (!mag_detected || mag_too_strong || mag_too_weak)
				printf("\ras5600 magnet error    ");
			else			
			{
				printf("\ras5600=%.3f(%d), state=%02x        ", value*360.0f/4095*4-206, value, state);
				phase = (value*360.0f/4095*4-206 + 100)*PI/180;
				//phase = 0;
			}
		}
		else
		{
			printf("\ras5600 error    ");
		}
		
		int A = power * sin(phase + PI * 0 / 3) + range/2;
		int B = power * sin(phase + PI * 2 / 3) + range/2;
		int C = power * sin(phase + PI * 4 / 3) + range/2;
		
		//systimer->delayus(100);
		
		
		//phase += 2 * PI / 10000 * 5;
		
		//if (phase > 2 * PI)
		//	phase -= 2*PI;
		
		//led.write(phase > PI);
		led.toggle();
		
		//if (systimer->gettime() > 500000 && systimer->gettime() < 5000000)
		if (1)
		{
			TIM1->CCR1 = A;
			TIM1->CCR2 = B;
			TIM1->CCR3 = C;
			pb5.write(true);
		}
		else
		{
			
			TIM1->CCR1 = 0;
			TIM1->CCR2 = 0;
			TIM1->CCR3 = 0;
			pb5.write(true);
		}
		
	}
}

